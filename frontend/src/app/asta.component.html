
<div class="min-h-screen bg-gray-950 text-gray-100 p-4 sm:p-8 font-sans antialiased">
<p-toast></p-toast>
<div class="container mx-auto max-w-7xl">
<!-- Header Bar -->
<header class="bg-gray-900 p-4 rounded-3xl shadow-2xl flex flex-col sm:flex-row items-center justify-between gap-4 mb-8 border border-gray-800">
<div class="flex items-center gap-4">
<div class="text-3xl font-extrabold flex items-center gap-2 text-blue-400">
<i class="pi pi-shopping-bag text-yellow-400 text-3xl"></i>
<span class="bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-emerald-400">FantaMercato</span>
</div>
</div>
<div class="flex items-center gap-6 mt-4 sm:mt-0">
<div *ngFor="let team of teams().slice(0, 5)" class="flex items-center gap-2 text-sm font-semibold p-2 bg-gray-800 rounded-full pr-4 shadow-inner border border-gray-700">
<i class="pi pi-user text-blue-300 w-5 h-5"></i>
<span>{{ team.name }}</span>
<div class="flex items-center gap-1 text-yellow-400">
<i class="pi pi-money-bill w-4 h-4"></i>
<span>{{ team.credits }}</span>
</div>
</div>
</div>
</header>

<div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
  <!-- Team List Section -->
  <div class="lg:col-span-1 flex flex-col gap-6">
    <p-panel header="Squadre" class="rounded-3xl shadow-2xl">
      <div class="overflow-y-auto max-h-[400px] space-y-3 custom-scrollbar">
        <div *ngFor="let team of teams()" 
             (click)="onTeamSelect(team.id)"
             [ngClass]="{'ring-2 ring-blue-500 bg-blue-900/50': team.id === currentTeamId(), 'bg-gray-800 hover:bg-gray-700': team.id !== currentTeamId()}"
             class="p-4 rounded-2xl cursor-pointer flex items-center justify-between transition-all duration-300 transform hover:scale-105 shadow-lg border border-gray-700">
          <div class="flex items-center gap-3">
            <span class="text-sm font-bold text-white">{{ team.name }}</span>
          </div>
          <div class="flex items-center gap-2 text-yellow-400">
            <i class="pi pi-money-bill w-5 h-5"></i>
            <span class="text-lg font-bold">{{ team.credits }}</span>
          </div>
        </div>
      </div>
    </p-panel>

    <div *ngIf="currentTeamId()" class="p-6 rounded-3xl bg-gray-900 text-white shadow-2xl transition-opacity duration-500 ease-in-out border border-gray-800"
         [ngClass]="{'opacity-100': currentTeamId(), 'opacity-0': !currentTeamId()}">
      <h3 class="text-xl font-bold mb-4 text-emerald-400 border-b border-gray-700 pb-2">La tua Squadra</h3>
      <div class="flex flex-wrap gap-2">
        <div *ngFor="let player of selectedTeamPlayers"
             [style.backgroundColor]="getPlayerCardBg(player)"
             [style.borderColor]="getPlayerCardBorder(player)"
             class="w-16 h-16 flex items-center justify-center text-xs text-white font-bold rounded-full transition-all duration-300 border-2 shadow-md hover:scale-105">
          {{ getPlayerInitials(player) }}
        </div>
      </div>
    </div>
  </div>

  <div class="lg:col-span-3 grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Player List Section -->
    <div class="md:col-span-1 bg-gray-900 p-6 rounded-3xl shadow-2xl h-full flex flex-col border border-gray-800">
      <p-panel header="Listone Giocatori" class="flex-grow">
        <div class="flex flex-wrap items-center justify-center sm:justify-start gap-2 mb-4">
          <p-button *ngFor="let role of roles"
                    (onClick)="setSelectedRole(role)"
                    [label]="role"
                    [styleClass]="selectedRole() === role ? 'p-button-success p-button-sm' : 'p-button-secondary p-button-sm p-button-outlined'">
          </p-button>
        </div>
        <div class="relative w-full mb-6">
          <span class="p-input-icon-left w-full">
            <i class="pi pi-search text-gray-400"></i>
            <input pInputText type="text" [(ngModel)]="searchTerm" placeholder="Cerca giocatore..." class="w-full bg-gray-800 text-white pl-10 pr-4 py-2 rounded-full border border-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200">
          </span>
        </div>
        <div class="overflow-y-auto max-h-[500px] flex-grow space-y-2 custom-scrollbar pr-2">
          <div *ngFor="let player of filteredPlayers()"
               (click)="onSelectPlayer(player)"
               [ngClass]="{
                 'bg-green-800/40 text-gray-400 cursor-not-allowed opacity-70': player.status === 'acquired',
                 'ring-2 ring-yellow-400 bg-yellow-900/50': player.status === 'in-auction',
                 'bg-gray-800 hover:bg-gray-700 cursor-pointer': player.status === 'available'
               }"
               class="flex items-center justify-between p-3 rounded-xl transition-all duration-200 transform hover:scale-105 shadow-md border border-gray-700">
            <div class="flex items-center gap-4">
              <span class="px-2 py-1 rounded-full text-xs font-bold w-6 h-6 flex items-center justify-center"
                    [ngClass]="{
                      'bg-blue-600': player.role === 'P',
                      'bg-green-600': player.role === 'D',
                      'bg-yellow-600': player.role === 'C',
                      'bg-red-600': player.role === 'A'
                    }">
                {{ player.role }}
              </span>
              <span class="font-semibold">{{ player.name }}</span>
            </div>
            <div class="flex items-center gap-2">
              <span class="text-sm text-gray-400 hidden sm:block">{{ player.team }}</span>
              <p-button *ngIf="player.status === 'available'"
                        (click)="startAuction(player); $event.stopPropagation()"
                        icon="pi pi-bolt" label="Avvia Asta" styleClass="p-button-sm p-button-info">
              </p-button>
              <span *ngIf="player.status === 'in-auction'" class="text-sm text-yellow-400 font-bold">In Asta</span>
              <span *ngIf="player.status === 'acquired'" class="text-sm text-green-400 font-bold">Acquistato</span>
            </div>
          </div>
        </div>
      </p-panel>
    </div>

    <!-- Player Card & Console -->
    <div class="md:col-span-1 grid grid-cols-1 gap-6">
      <!-- Player Card -->
      <p-card [header]="selectedPlayer() ? selectedPlayer()!.name : 'NESSUN GIOCATORE SELEZIONATO'"
              subheader="{{ selectedPlayer()?.team }} | {{ selectedPlayer()?.role }}"
              class="h-full rounded-3xl shadow-2xl overflow-hidden card-header border border-gray-800">
        <ng-template pTemplate="header">
          <div class="flex items-center justify-center p-4">
            <div class="w-32 h-32 rounded-full overflow-hidden border-4 border-gray-600 bg-gray-800 flex items-center justify-center shadow-inner">
              <i class="pi pi-user text-gray-400 text-6xl"></i>
            </div>
          </div>
        </ng-template>
        <div *ngIf="selectedPlayer()" class="text-center">
          <div class="grid grid-cols-2 gap-4 w-full text-center font-bold text-white mt-4">
            <div class="p-3 bg-gray-800 rounded-xl shadow-md border border-gray-700"><span class="text-xl">100</span><p class="text-gray-400 text-xs mt-1">Integrit√†</p></div>
            <div class="p-3 bg-gray-800 rounded-xl shadow-md border border-gray-700"><span class="text-xl">4.82</span><p class="text-gray-400 text-xs mt-1">FANTAVOTO</p></div>
            <div class="p-3 bg-gray-800 rounded-xl shadow-md border border-gray-700"><span class="text-xl">{{ selectedPlayer()?.value }}</span><p class="text-gray-400 text-xs mt-1">Prezzo Minimo</p></div>
            <div class="p-3 bg-gray-800 rounded-xl shadow-md border border-gray-700"><span class="text-xl">4.82</span><p class="text-gray-400 text-xs mt-1">Prezzo Medio</p></div>
          </div>
          <div class="mt-8 text-center text-white">
            <div class="text-4xl font-extrabold text-green-400">
              <span class="text-sm text-gray-400 font-normal">Offerta Attuale: </span>
              {{ currentAuction()?.bid || selectedPlayer()?.value }}
            </div>
            <p class="text-sm text-gray-400 mt-2">Vincitore: <span class="font-bold text-blue-300">{{ getWinnerName() }}</span></p>
          </div>
          <div class="mt-8 flex flex-col w-full gap-3">
            <p-button label="Offri +1" styleClass="p-button-info w-full p-button-lg" (onClick)="placeBid(currentAuction()?.bid! + 1)" [disabled]="!currentAuction()"></p-button>
            <p-button label="Offri +5" styleClass="p-button-info w-full p-button-lg" (onClick)="placeBid(currentAuction()?.bid! + 5)" [disabled]="!currentAuction()"></p-button>
          </div>
        </div>
        <div *ngIf="!selectedPlayer()" class="text-center text-gray-400 mt-8">
          <i class="pi pi-trophy text-9xl mx-auto mb-4 w-32 h-32"></i>
          <p class="text-lg mt-2 font-semibold">Seleziona un giocatore per avviare l'asta.</p>
        </div>
      </p-card>

      <!-- Console & History -->
      <div class="grid grid-cols-1 gap-6">
        <div class="bg-gray-900 p-6 rounded-3xl shadow-2xl h-full flex flex-col justify-between border border-gray-800">
          <p-card header="Console Asta" class="text-center h-full">
            <div *ngIf="currentAuction(); else noAuction" class="flex flex-col h-full justify-between">
              <div>
                <h3 class="text-5xl font-extrabold text-green-400 animate-pulse">{{ currentAuction()?.bid }}</h3>
                <p class="text-sm text-gray-400 mt-2">Vincitore: <span class="font-bold text-blue-300">{{ getWinnerName() }}</span></p>
                <div class="mt-6 flex items-center justify-center gap-4 text-white">
                  <i class="pi pi-clock w-8 h-8 text-red-500"></i>
                  <span class="text-4xl font-extrabold text-red-400">{{ timeLeft() }}</span>
                </div>
              </div>
              <div class="mt-auto flex flex-col gap-3">
                <p-button label="Offri" styleClass="p-button-info w-full p-button-lg" (onClick)="placeBid(currentAuction()?.bid! + 1)"></p-button>
                <p-button label="Chiudi Asta" styleClass="p-button-danger w-full p-button-lg" (onClick)="endAuction()"></p-button>
              </div>
            </div>
            <ng-template #noAuction>
              <div class="flex flex-col items-center justify-center h-full">
                <i class="pi pi-trophy text-9xl mx-auto mb-4 w-24 h-24 text-gray-500"></i>
                <h3 class="text-2xl font-bold text-gray-400">Nessuna Asta in corso</h3>
                <p class="text-sm mt-2 text-gray-500">Avvia un'asta per iniziare.</p>
              </div>
            </ng-template>
          </p-card>
        </div>
        
        <div class="bg-gray-900 p-6 rounded-3xl shadow-2xl h-full flex flex-col border border-gray-800">
          <p-panel header="Storico">
            <div class="overflow-y-auto max-h-[300px] space-y-3 custom-scrollbar pr-2">
              <div *ngFor="let item of auctionHistory()"
                   class="flex justify-between items-center p-3 rounded-xl bg-gray-800 text-white shadow-md border border-gray-700">
                <div class="flex items-center gap-3">
                  <span class="text-sm font-semibold">{{ item.player.name }}</span>
                  <span class="text-xs px-2 py-1 rounded-full font-bold"
                        [ngClass]="{'bg-green-600 text-white': item.status === 'vinto', 'bg-red-600 text-white': item.status !== 'vinto'}">
                    {{ item.status }}
                  </span>
                </div>
                <div class="flex items-center gap-2">
                  <span class="text-lg font-bold text-yellow-400">{{ item.bid }}</span>
                  <i class="pi pi-money-bill w-4 h-4 text-yellow-400"></i>
                  <span class="text-sm text-gray-400">{{ item.winner.name }}</span>
                </div>
              </div>
            </div>
          </p-panel>
        </div>
      </div>
    </div>
  </div>
</div>

</div>
</div>